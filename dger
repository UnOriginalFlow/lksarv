-- Dreamyware v2.0 - Counter Blox Hub âš¡ Blue/Black Edition
-- Optimized for Xeno/Solara/KRNL

local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local Window = OrionLib:MakeWindow({
    Name = "Dreamyware v2.0", 
    HidePremium = false, 
    SaveConfig = true, 
    ConfigFolder = "DreamywareCBX", 
    IntroEnabled = true, 
    IntroText = "B l u e  D o m i n a t i o n", 
    IntroIcon = "rbxassetid://4483345998"
})

-- Force Blue/Black Theme
task.spawn(function()
    task.wait(0.5)
    for _, obj in game:GetService("CoreGui"):GetDescendants() do
        if obj:IsA("Frame") then
            obj.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
            obj.BorderColor3 = Color3.fromRGB(0, 162, 255)
        elseif obj:IsA("TextLabel") or obj:IsA("TextButton") then
            obj.Font = Enum.Font.GothamBold
            obj.TextColor3 = Color3.fromRGB(255, 255, 255)
        end
    end
end)

-- Global Variables
getgenv().AimbotEnabled = false
getgenv().SmoothEnabled = false
getgenv().TeamCheck = true
getgenv().AimFOV = 120
getgenv().AimPart = "Head"
getgenv().FOVVisible = false

getgenv().BoxEnabled = false
getgenv().NameEnabled = false
getgenv().WeaponEnabled = false
getgenv().SkeletonEnabled = false
getgenv().HeadDotEnabled = false
getgenv().ChamsEnabled = false

getgenv().RainbowGun = false
getgenv().WalkSpeedValue = 16

-- Services
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Drawing Objects Storage
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 100
FOVCircle.Radius = getgenv().AimFOV
FOVCircle.Filled = false
FOVCircle.Color = Color3.fromRGB(0, 162, 255)
FOVCircle.Visible = false

local ESP_Data = {}

-- Helper: Create ESP for a player
local function CreateESP(plr)
    if plr == LocalPlayer then return end
    
    local data = {
        Box = Drawing.new("Square"),
        Name = Drawing.new("Text"),
        Weapon = Drawing.new("Text"),
        HeadDot = Drawing.new("Circle"),
        Skeleton = Drawing.new("Line") -- Simplified single spine line
    }
    
    data.Box.Thickness = 1
    data.Box.Color = Color3.fromRGB(0, 162, 255)
    
    data.Name.Size = 14
    data.Name.Center = true
    data.Name.Outline = true
    data.Name.Color = Color3.fromRGB(255, 255, 255)
    
    data.Weapon.Size = 13
    data.Weapon.Center = true
    data.Weapon.Outline = true
    data.Weapon.Color = Color3.fromRGB(0, 255, 150)
    
    data.HeadDot.Filled = true
    data.HeadDot.Radius = 3
    data.HeadDot.Color = Color3.fromRGB(255, 0, 0)
    
    data.Skeleton.Thickness = 1
    data.Skeleton.Color = Color3.fromRGB(255, 255, 255)
    
    ESP_Data[plr] = data
end

-- Cleanup
local function RemoveESP(plr)
    if ESP_Data[plr] then
        for _, obj in pairs(ESP_Data[plr]) do
            obj:Remove()
        end
        ESP_Data[plr] = nil
    end
end

-- Initialize ESP for existing players
for _, plr in pairs(Players:GetPlayers()) do CreateESP(plr) end
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)

-- Main Logic Loop
RunService.RenderStepped:Connect(function()
    -- Update FOV Circle
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Radius = getgenv().AimFOV
    FOVCircle.Visible = getgenv().FOVVisible and getgenv().AimbotEnabled

    local ClosestPlayer = nil
    local MaxDist = getgenv().AimFOV

    for _, plr in pairs(Players:GetPlayers()) do
        local char = plr.Character
        local data = ESP_Data[plr]
        
        if char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChild("Head") and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0 then
            local root = char.HumanoidRootPart
            local head = char.Head
            local pos, onScreen = Camera:WorldToViewportPoint(root.Position)
            local headPos = Camera:WorldToViewportPoint(head.Position)
            local legPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3.5, 0))
            
            -- Team Check Logic
            local isTeammate = (getgenv().TeamCheck and plr.Team == LocalPlayer.Team)

            if onScreen and not isTeammate then
                -- Aimbot Detection
                local screenPos = Vector2.new(pos.X, pos.Y)
                local mousePos = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
                local dist = (screenPos - mousePos).Magnitude
                
                if dist < MaxDist then
                    MaxDist = dist
                    ClosestPlayer = char:FindFirstChild(getgenv().AimPart)
                end

                -- ESP Rendering
                if data then
                    local height = math.abs(headPos.Y - legPos.Y)
                    local width = height * 0.6
                    
                    data.Box.Visible = getgenv().BoxEnabled
                    data.Box.Size = Vector2.new(width, height)
                    data.Box.Position = Vector2.new(pos.X - width/2, pos.Y - height/2)
                    
                    data.Name.Visible = getgenv().NameEnabled
                    data.Name.Text = plr.Name
                    data.Name.Position = Vector2.new(pos.X, pos.Y - height/2 - 15)
                    
                    data.Weapon.Visible = getgenv().WeaponEnabled
                    local tool = char:FindFirstChildOfClass("Tool")
                    data.Weapon.Text = tool and tool.Name or "None"
                    data.Weapon.Position = Vector2.new(pos.X, pos.Y + height/2 + 5)
                    
                    data.HeadDot.Visible = getgenv().HeadDotEnabled
                    data.HeadDot.Position = Vector2.new(headPos.X, headPos.Y)
                    
                    data.Skeleton.Visible = getgenv().SkeletonEnabled
                    data.Skeleton.From = Vector2.new(headPos.X, headPos.Y)
                    data.Skeleton.To = Vector2.new(pos.X, pos.Y)
                end
                
                -- Chams (Highlights)
                local cham = char:FindFirstChild("DreamyCham")
                if getgenv().ChamsEnabled then
                    if not cham then
                        cham = Instance.new("Highlight")
                        cham.Name = "DreamyCham"
                        cham.Parent = char
                        cham.FillColor = Color3.fromRGB(0, 162, 255)
                        cham.OutlineColor = Color3.new(1, 1, 1)
                    end
                    cham.Enabled = true
                elseif cham then
                    cham.Enabled = false
                end
            else
                -- Hide ESP if not visible or teammate
                if data then
                    for _, obj in pairs(data) do obj.Visible = false end
                end
                if char:FindFirstChild("DreamyCham") then char.DreamyCham.Enabled = false end
            end
        else
            -- Hide ESP if dead/nil
            if data then
                for _, obj in pairs(data) do obj.Visible = false end
            end
        end
    end

    -- Aimbot Execution
    if getgenv().AimbotEnabled and ClosestPlayer and game:GetService("UserInputService"):IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        if getgenv().SmoothEnabled then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, ClosestPlayer.Position), 0.15)
        else
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, ClosestPlayer.Position)
        end
    end

    -- Rainbow Gun
    if getgenv().RainbowGun then
        local vm = Camera:FindFirstChild("ViewModel") or Camera:FindFirstChildWhichIsA("Model")
        if vm then
            for _, part in pairs(vm:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Color = Color3.fromHSV(tick() % 5 / 5, 1, 1)
                end
            end
        end
    end
end)

-- Tabs
local Tab1 = Window:MakeTab({ Name = "Aimbot", Icon = "rbxassetid://4483362458" })
local Tab2 = Window:MakeTab({ Name = "Visuals", Icon = "rbxassetid://4483360976" })
local Tab3 = Window:MakeTab({ Name = "Extras", Icon = "rbxassetid://4483361427" })

-- Aimbot UI
Tab1:AddToggle({ Name = "Aimbot", Default = false, Callback = function(v) getgenv().AimbotEnabled = v end })
Tab1:AddToggle({ Name = "Smoothing", Default = false, Callback = function(v) getgenv().SmoothEnabled = v end })
Tab1:AddToggle({ Name = "Team Check", Default = true, Callback = function(v) getgenv().TeamCheck = v end })
Tab1:AddToggle({ Name = "Show FOV", Default = false, Callback = function(v) getgenv().FOVVisible = v end })
Tab1:AddSlider({ Name = "FOV Size", Min = 30, Max = 500, Default = 120, Callback = function(v) getgenv().AimFOV = v end })
Tab1:AddDropdown({ Name = "Target", Default = "Head", Options = {"Head", "HumanoidRootPart"}, Callback = function(v) getgenv().AimPart = v end })

-- Visuals UI
Tab2:AddToggle({ Name = "Box ESP", Default = false, Callback = function(v) getgenv().BoxEnabled = v end })
Tab2:AddToggle({ Name = "Name ESP", Default = false, Callback = function(v) getgenv().NameEnabled = v end })
Tab2:AddToggle({ Name = "Weapon ESP", Default = false, Callback = function(v) getgenv().WeaponEnabled = v end })
Tab2:AddToggle({ Name = "Skeleton", Default = false, Callback = function(v) getgenv().SkeletonEnabled = v end })
Tab2:AddToggle({ Name = "Head Dot", Default = false, Callback = function(v) getgenv().HeadDotEnabled = v end })
Tab2:AddToggle({ Name = "Chams", Default = false, Callback = function(v) getgenv().ChamsEnabled = v end })

-- Extras UI
Tab3:AddToggle({ Name = "Rainbow Gun/Knife", Default = false, Callback = function(v) getgenv().RainbowGun = v end })
Tab3:AddSlider({ Name = "Walkspeed", Min = 16, Max = 150, Default = 16, Callback = function(v) getgenv().WalkSpeedValue = v end })
Tab3:AddButton({ Name = "Rejoin Server", Callback = function() game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer) end })

-- Persistent Walkspeed Loop
task.spawn(function()
    while task.wait() do
        pcall(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = getgenv().WalkSpeedValue
            end
        end)
    end
end)

OrionLib:Init()
